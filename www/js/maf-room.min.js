// Copyright 2005-2015 Metrological
// All Rights Reserved.
(function (z, P, X, Y, T) {
  function D(d, m, k) {
    d && d.__defineGetter__(m, k)
  }

  function ca(d) {
    for (var m = {}, k; k = ia.exec(d);)m[k[1]] = k[2];
    return m
  }

  if (P && z && X) {
    var ja = z.MAF = z.MAF = {}, Z = !0, da = P.origin, Q = RegExp, B = String, U = B("prototype"), ka = B("constructor"), S = B("metrological"), la = B("maf-room"), ma = B("1.0.0"), M = B("https"), V = ["b48ce274efe63bc264a6e101f867da83", "b1dd87949181e18eb98f4d68002b6f2ac9c12565536e2e03d8806f6e97e48a30"], aa = Array[U], na = Function[U], ea = z.JSON, oa = z.ArrayBuffer, pa = z.Uint8Array, qa = z.WebSocket, ra = z.clearInterval,
        sa = z.setInterval, fa = z.setTimeout, ta = P.protocol === M + ":" ? "wss" : "ws", M = B(M + "?://"), ia = /\??(.*?)=([^\&]*)&?/gi, ua = Q("^" + M + Y[0] + "." + S + ".com$");
    (function (d) {
      function m(d) {
        if ("function" !== typeof this)throw"function not callable";
        var m = aa.slice.call(arguments, 1), g = this, p = function () {
        }, x = function () {
          return g.apply(this instanceof p && d ? this : d, m.concat(aa.slice.call(arguments || [])))
        };
        p[U] = this[U];
        x[U] = new p;
        return x
      }

      d.bind || D(d, "bind", function () {
        return m
      })
    })(na);
    var W = function (d) {
      function m(d, e, f, a, c, b) {
        e = t(t(e,
            d), t(a, b));
        return t(e << c | e >>> 32 - c, f)
      }

      function k(d, e, f, a, c, b, g) {
        return m(e & f | ~e & a, d, e, c, b, g)
      }

      function r(d, e, f, a, c, b, g) {
        return m(e & a | f & ~a, d, e, c, b, g)
      }

      function g(d, e, f, a, c, b, g) {
        return m(f ^ (e | ~a), d, e, c, b, g)
      }

      function p(d, e) {
        var f = d[0], a = d[1], c = d[2], b = d[3], f = k(f, a, c, b, e[0], 7, -680876936), b = k(b, f, a, c, e[1], 12, -389564586), c = k(c, b, f, a, e[2], 17, 606105819), a = k(a, c, b, f, e[3], 22, -1044525330), f = k(f, a, c, b, e[4], 7, -176418897), b = k(b, f, a, c, e[5], 12, 1200080426), c = k(c, b, f, a, e[6], 17, -1473231341), a = k(a, c, b, f, e[7], 22, -45705983),
            f = k(f, a, c, b, e[8], 7, 1770035416), b = k(b, f, a, c, e[9], 12, -1958414417), c = k(c, b, f, a, e[10], 17, -42063), a = k(a, c, b, f, e[11], 22, -1990404162), f = k(f, a, c, b, e[12], 7, 1804603682), b = k(b, f, a, c, e[13], 12, -40341101), c = k(c, b, f, a, e[14], 17, -1502002290), a = k(a, c, b, f, e[15], 22, 1236535329), f = r(f, a, c, b, e[1], 5, -165796510), b = r(b, f, a, c, e[6], 9, -1069501632), c = r(c, b, f, a, e[11], 14, 643717713), a = r(a, c, b, f, e[0], 20, -373897302), f = r(f, a, c, b, e[5], 5, -701558691), b = r(b, f, a, c, e[10], 9, 38016083), c = r(c, b, f, a, e[15], 14, -660478335), a = r(a, c, b, f, e[4], 20, -405537848),
            f = r(f, a, c, b, e[9], 5, 568446438), b = r(b, f, a, c, e[14], 9, -1019803690), c = r(c, b, f, a, e[3], 14, -187363961), a = r(a, c, b, f, e[8], 20, 1163531501), f = r(f, a, c, b, e[13], 5, -1444681467), b = r(b, f, a, c, e[2], 9, -51403784), c = r(c, b, f, a, e[7], 14, 1735328473), a = r(a, c, b, f, e[12], 20, -1926607734), f = m(a ^ c ^ b, f, a, e[5], 4, -378558), b = m(f ^ a ^ c, b, f, e[8], 11, -2022574463), c = m(b ^ f ^ a, c, b, e[11], 16, 1839030562), a = m(c ^ b ^ f, a, c, e[14], 23, -35309556), f = m(a ^ c ^ b, f, a, e[1], 4, -1530992060), b = m(f ^ a ^ c, b, f, e[4], 11, 1272893353), c = m(b ^ f ^ a, c, b, e[7], 16, -155497632), a = m(c ^ b ^ f,
                a, c, e[10], 23, -1094730640), f = m(a ^ c ^ b, f, a, e[13], 4, 681279174), b = m(f ^ a ^ c, b, f, e[0], 11, -358537222), c = m(b ^ f ^ a, c, b, e[3], 16, -722521979), a = m(c ^ b ^ f, a, c, e[6], 23, 76029189), f = m(a ^ c ^ b, f, a, e[9], 4, -640364487), b = m(f ^ a ^ c, b, f, e[12], 11, -421815835), c = m(b ^ f ^ a, c, b, e[15], 16, 530742520), a = m(c ^ b ^ f, a, c, e[2], 23, -995338651), f = g(f, a, c, b, e[0], 6, -198630844), b = g(b, f, a, c, e[7], 10, 1126891415), c = g(c, b, f, a, e[14], 15, -1416354905), a = g(a, c, b, f, e[5], 21, -57434055), f = g(f, a, c, b, e[12], 6, 1700485571), b = g(b, f, a, c, e[3], 10, -1894986606), c = g(c, b, f, a, e[10],
                15, -1051523), a = g(a, c, b, f, e[1], 21, -2054922799), f = g(f, a, c, b, e[8], 6, 1873313359), b = g(b, f, a, c, e[15], 10, -30611744), c = g(c, b, f, a, e[6], 15, -1560198380), a = g(a, c, b, f, e[13], 21, 1309151649), f = g(f, a, c, b, e[4], 6, -145523070), b = g(b, f, a, c, e[11], 10, -1120210379), c = g(c, b, f, a, e[2], 15, 718787259), a = g(a, c, b, f, e[9], 21, -343485551);
        d[0] = t(f, d[0]);
        d[1] = t(a, d[1]);
        d[2] = t(c, d[2]);
        d[3] = t(b, d[3])
      }

      function x(d) {
        var e = d.length, f = [1732584193, -271733879, -1732584194, 271733878], a, c, b;
        for (a = 64; a <= e; a += 64) {
          b = d.substring(a - 64, a);
          c = [];
          for (var g =
              void 0, g = 0; 64 > g; g += 4)c[g >> 2] = b.charCodeAt(g) + (b.charCodeAt(g + 1) << 8) + (b.charCodeAt(g + 2) << 16) + (b.charCodeAt(g + 3) << 24);
          p(f, c)
        }
        d = d.substring(a - 64);
        c = d.length;
        b = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        for (a = 0; a < c; a += 1)b[a >> 2] |= d.charCodeAt(a) << (a % 4 << 3);
        b[a >> 2] |= 128 << (a % 4 << 3);
        if (55 < a)for (p(f, b), a = 0; 16 > a; a += 1)b[a] = 0;
        e = (8 * e).toString(16).match(/(.*?)(.{0,8})$/);
        d = parseInt(e[2], 16);
        e = parseInt(e[1], 16) || 0;
        b[14] = d;
        b[15] = e;
        p(f, b);
        return f
      }

      function w(d) {
        for (var e = 0; e < d.length; e += 1) {
          for (var f = e, a = d[e], c = "", b = void 0,
                   b = 0; 4 > b; b += 1)c += y[a >> 8 * b + 4 & 15] + y[a >> 8 * b & 15];
          d[f] = c
        }
        return d.join("")
      }

      var y = "0123456789abcdef".split(""), t = function (d, e) {
        return d + e & 4294967295
      };
      w(x(S)) !== d && (t = function (d, e) {
        var f = (d & 65535) + (e & 65535);
        return (d >> 16) + (e >> 16) + (f >> 16) << 16 | f & 65535
      });
      if (w(x(S)) === d)return function (d) {
        return w(x(d))
      };
      throw"unknown error";
    }(V[0]), Z = function (d, m) {
      var k;
      a:{
        if (d)for (k = 0; k < m.length; k++)if (m[k].test(d)) {
          k = !0;
          break a
        }
        k = !1
      }
      return k
    }(da, [Q("^" + M + "10.(\\d{1,3}).(\\d{1,3}).(\\d{1,3}):?\\d*$"), Q("^" + M + "172.(1[6-9]|2[0-9]|3[0-1]).(\\d{1,3}).(\\d{1,3}):?\\d*$"),
      Q("^" + M + "192.168.(\\d{1,3}).(\\d{1,3}):?\\d*$"), Q("^.*$")]), ga = function (d, m, k, r) {
      var g = [];
      return function (p) {
        var x = "string" !== typeof p;
        x && p[ka] === oa && (p = new pa(p));
        var w, y, t, K, e, f, a, c, b, z = !0, D = !1, h, A = 0, B = 0, u = 0, v = p.length, q, l, L, N, O, R;
        w = 1779033703;
        y = 3144134277;
        t = 1013904242;
        K = 2773480762;
        e = 1359893119;
        f = 2600822924;
        a = 528734635;
        c = 1541459225;
        b = 0;
        do {
          g[0] = b;
          g[16] = g[1] = g[2] = g[3] = g[4] = g[5] = g[6] = g[7] = g[8] = g[9] = g[10] = g[11] = g[12] = g[13] = g[14] = g[15] = 0;
          if (x)for (h = B; A < v && 64 > h; ++A)g[h >> 2] |= p[A] << k[h++ &
              3]; else for (h = B; A < v && 64 > h; ++A)b = p.charCodeAt(A), 128 > b ? g[h >> 2] |= b << k[h++ & 3] : (2048 > b ? g[h >> 2] |= (192 | b >> 6) << k[h++ & 3] : (55296 > b || 57344 <= b ? g[h >> 2] |= (224 | b >> 12) << k[h++ & 3] : (b = 65536 + ((b & 1023) << 10 | p.charCodeAt(++A) & 1023), g[h >> 2] |= (240 | b >> 18) << k[h++ & 3], g[h >> 2] |= (128 | b >> 12 & 63) << k[h++ & 3]), g[h >> 2] |= (128 | b >> 6 & 63) << k[h++ & 3]), g[h >> 2] |= (128 | b & 63) << k[h++ & 3]);
          u += h - B;
          B = h - 64;
          A == v && (g[h >> 2] |= m[h & 3], ++A);
          b = g[16];
          A > v && 56 > h && (g[15] = u << 3, D = !0);
          var C = w, n = y, E = t, F = K, H = e, I = f, J = a, G = c;
          for (h = 16; 64 > h; ++h)l = g[h - 15], q = (l >>> 7 | l << 25) ^ (l >>>
              18 | l << 14) ^ l >>> 3, l = g[h - 2], l = (l >>> 17 | l << 15) ^ (l >>> 19 | l << 13) ^ l >>> 10, g[h] = g[h - 16] + q + g[h - 7] + l << 0;
          R = n & E;
          for (h = 0; 64 > h; h += 4)z ? (O = 704751109, l = g[0] - 210244248, G = l - 1521486534 << 0, F = l + 143694565 << 0, z = !1) : (q = (C >>> 2 | C << 30) ^ (C >>> 13 | C << 19) ^ (C >>> 22 | C << 10), l = (H >>> 6 | H << 26) ^ (H >>> 11 | H << 21) ^ (H >>> 25 | H << 7), O = C & n, L = O ^ C & E ^ R, N = H & I ^ ~H & J, l = G + l + N + r[h] + g[h], q += L, G = F + l << 0, F = l + q << 0), q = (F >>> 2 | F << 30) ^ (F >>> 13 | F << 19) ^ (F >>> 22 | F << 10), l = (G >>> 6 | G << 26) ^ (G >>> 11 | G << 21) ^ (G >>> 25 | G << 7), R = F & C, L = R ^ F & n ^ O, N = G & H ^ ~G & I, l = J + l + N + r[h + 1] + g[h + 1], q += L, J = E + l <<
              0, E = l + q << 0, q = (E >>> 2 | E << 30) ^ (E >>> 13 | E << 19) ^ (E >>> 22 | E << 10), l = (J >>> 6 | J << 26) ^ (J >>> 11 | J << 21) ^ (J >>> 25 | J << 7), O = E & F, L = O ^ E & C ^ R, N = J & G ^ ~J & H, l = I + l + N + r[h + 2] + g[h + 2], q += L, I = n + l << 0, n = l + q << 0, q = (n >>> 2 | n << 30) ^ (n >>> 13 | n << 19) ^ (n >>> 22 | n << 10), l = (I >>> 6 | I << 26) ^ (I >>> 11 | I << 21) ^ (I >>> 25 | I << 7), R = n & E, L = R ^ n & F ^ O, N = I & J ^ ~I & G, l = H + l + N + r[h + 3] + g[h + 3], q += L, H = C + l << 0, C = l + q << 0;
          w = w + C << 0;
          y = y + n << 0;
          t = t + E << 0;
          K = K + F << 0;
          e = e + H << 0;
          f = f + I << 0;
          a = a + J << 0;
          c = c + G << 0
        } while (!D);
        return d[w >> 28 & 15] + d[w >> 24 & 15] + d[w >> 20 & 15] + d[w >> 16 & 15] + d[w >> 12 & 15] + d[w >> 8 & 15] + d[w >>
            4 & 15] + d[w & 15] + d[y >> 28 & 15] + d[y >> 24 & 15] + d[y >> 20 & 15] + d[y >> 16 & 15] + d[y >> 12 & 15] + d[y >> 8 & 15] + d[y >> 4 & 15] + d[y & 15] + d[t >> 28 & 15] + d[t >> 24 & 15] + d[t >> 20 & 15] + d[t >> 16 & 15] + d[t >> 12 & 15] + d[t >> 8 & 15] + d[t >> 4 & 15] + d[t & 15] + d[K >> 28 & 15] + d[K >> 24 & 15] + d[K >> 20 & 15] + d[K >> 16 & 15] + d[K >> 12 & 15] + d[K >> 8 & 15] + d[K >> 4 & 15] + d[K & 15] + d[e >> 28 & 15] + d[e >> 24 & 15] + d[e >> 20 & 15] + d[e >> 16 & 15] + d[e >> 12 & 15] + d[e >> 8 & 15] + d[e >> 4 & 15] + d[e & 15] + d[f >> 28 & 15] + d[f >> 24 & 15] + d[f >> 20 & 15] + d[f >> 16 & 15] + d[f >> 12 & 15] + d[f >> 8 & 15] + d[f >> 4 & 15] + d[f & 15] + d[a >> 28 & 15] + d[a >> 24 & 15] + d[a >> 20 & 15] + d[a >>
            16 & 15] + d[a >> 12 & 15] + d[a >> 8 & 15] + d[a >> 4 & 15] + d[a & 15] + d[c >> 28 & 15] + d[c >> 24 & 15] + d[c >> 20 & 15] + d[c >> 16 & 15] + d[c >> 12 & 15] + d[c >> 8 & 15] + d[c >> 4 & 15] + d[c & 15]
      }
    }("0123456789abcdef".split(""), [-2147483648, 8388608, 32768, 128], [24, 16, 8, 0], [1116352408, 1899447441, 3049323471, 3921009573, 961987163, 1508970993, 2453635748, 2870763221, 3624381080, 310598401, 607225278, 1426881987, 1925078388, 2162078206, 2614888103, 3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983, 1249150122, 1555081692, 1996064986, 2554220882, 2821834349, 2952996808,
      3210313671, 3336571891, 3584528711, 113926993, 338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700, 1986661051, 2177026350, 2456956037, 2730485921, 2820302411, 3259730800, 3345764771, 3516065817, 3600352804, 4094571909, 275423344, 430227734, 506948616, 659060556, 883997877, 958139571, 1322822218, 1537002063, 1747873779, 1955562222, 2024104815, 2227730452, 2361852424, 2428436474, 2756734187, 3204031479, 3329325298]), ba;
    a:{
      try {
        ba = ca(P.search);
        break a
      } catch (wa) {
      }
      ba = void 0
    }
    var va = ba || {}, ha = function (d) {
          for (var m = 0; m < d.length; m++) {
            var k =
                (d[m].src || "").split("#");
            if (1 < k.length && Q(la + ".(min.js|js)").test(k[0]))return ca(k[1])
          }
        }(X.getElementsByTagName("script")) || {};
    ja.Room = function (d, m, k, r, g) {
      function p(a) {
        this.events = this.events || {};
        if (!1 !== a in this.events)for (var b = aa.slice.call(arguments, 1), d = 0; d < this.events[a].length; d++)this.events[a][d].apply(this, b)
      }

      function x(a) {
        if (P && n && 1 === n.readyState)return n.send(ea.stringify(a));
        L.push(a)
      }

      function w() {
        x({e: "s"})
      }

      function y(a) {
        if (this.joined)return ra(a);
        this.join()
      }

      function t() {
        P = !0;
        A = 0;
        for (var a in v) {
          var b = v[a];
          b.user = T;
          p.call(b, "connected", {hash: a});
          var d = sa(y.bind(b, d), 3E3)
        }
        for (; L.length;)a = L.pop(), x(a)
      }

      function z(a) {
        var b = ea.parse(a.data), d = b.e, f = b.k, c = b.h, e = b.u;
        a = b.d;
        var g = v[c];
        if ("s" === d || f || g)switch (d) {
          case "j":
            if (f && r)return u[c] = (u[c] || []).concat(e), p.call(h, "created", {
              id: l[f],
              hash: c,
              user: e,
              data: a
            });
            g.joined = !0;
            g.user || (g.user = e);
            u[c] = u[c] || [];
            -1 === u[c].indexOf(e) && (u[c].push(e), p.call(g, "joined", {hash: c, user: e, data: a}));
            g.user !== e && x({e: "p", h: c, d: a});
            break;
          case "l":
            e ===
            g.user && (g.user = T);
            var k = u[c].indexOf(e);
            -1 < k && (u[c].splice(k, 1), p.call(g, "hasleft", {hash: c, user: e, data: a}));
            break;
          case "d":
            -1 !== u[c].indexOf(e) && p.call(g, "data", {hash: c, user: e, data: a});
            break;
          case "p":
            -1 === u[c].indexOf(e) && (u[c].push(e), p.call(g, "joined", {hash: c, user: e, data: a}));
            break;
          case "e":
            p.call(g, "error", {hash: c, user: e, code: b.c});
            break;
          case "s":
            c = [];
            b = "r" === b.t;
            for (k in q)c.push(q[k]);
            for (k = 0; k < a.length; k++)g = a[k], e = g.k, g = g.h, b ? (delete q[e], e = c.indexOf(g), -1 !== e && c.splice(e, 1)) : (q[e] = g, -1 ===
            c.indexOf(g) && c.push(g));
            0 < c.length && p.call(h, "discovery", {hashes: c})
        }
      }

      function e() {
        P = !1;
        q = [];
        A++;
        n && (n.onopen = n.onmessage = n.onclose = null);
        n = null;
        for (var a in v) {
          var b = v[a];
          b.joined && p.call(b, "disconnected", {hash: a});
          b.joined = T;
          b.user = T;
          u[a].length = 0
        }
        fa(f, 3E3 * A)
      }

      function f() {
        var a;
        (a = n) || (a = W(S) !== V[0] || ga(S) !== V[1] ? void 0 : new qa(ta + "://" + g[0] + g[C] + (Z ? "-" + Y[1] : "") + O + S + O + R));
        (n = a) ? (n.onopen = t, n.onmessage = z, n.onclose = e) : (A++, fa(f, 3E3 * A))
      }

      function a(a, b) {
        if (r) {
          var c = W(k + N + a);
          l[c] = a;
          x({e: "j", k: c, d: b})
        }
      }

      function c(a) {
        return v[a] !== T
      }

      function b(a) {
        a = W(k + N + a);
        return q[a]
      }

      function M(a, b) {
        this.events = this.events || {};
        this.events[a] = this.events[a] || [];
        this.events[a].push(b)
      }

      function Q(a, b) {
        this.events = this.events || {};
        if (!1 !== a in this.events) {
          var c = this.events[a].indexOf(b);
          -1 < c && this.events[a].splice(c, 1)
        }
      }

      function h(a) {
        a = a || ha.hash || va.hash;
        if (!a)throw"missing hash";
        if (v[a])return v[a];
        D(this, "hash", function () {
          return a
        });
        D(this, "users", function () {
          return u[a]
        });
        D(this, "connected", function () {
          return P
        });
        u[a] ? (this.joined = !0, this.user = u[a][0]) : (this.joined = !1, u[a] = []);
        v[a] = this
      }

      var A = 0, P = !1, u = {}, v = {}, q = {}, l = {}, L = [], N = B("|"), O = B("."), R = B("com"), C = g.length - 1, n;
      if (!k)throw"missing application identifier";
      f();
      h[U] = {
        join: function (a) {
          this.joined || x({e: "j", h: this.hash, d: a})
        }, leave: function (a) {
          this.user = T;
          x({e: "l", h: this.hash, d: a})
        }, send: function (a) {
          x({e: "d", h: this.hash, d: a})
        }, addEventListener: function (a, b) {
          M.call(this, a, b)
        }, removeEventListener: function (a, b) {
          Q.call(this, a, b)
        }, destroy: function () {
          if (v) {
            this.leave();
            for (var a in this.events || {})this.events[a] && (this.events[a].length = 0), delete this.events[a];
            delete this.events;
            u[this.hash] && (u[this.hash].length = 0);
            delete u[this.hash];
            delete v[this.hash]
          }
        }
      };
      D(h, "discover", function () {
        return w
      });
      D(h, "addEventListener", function () {
        return M.bind(this)
      });
      D(h, "removeEventListener", function () {
        return Q.bind(this)
      });
      D(h, "create", function () {
        return a
      });
      D(h, "exists", function () {
        return c
      });
      D(h, "hash", function () {
        return b
      });
      D(h, "version", function () {
        return ma
      });
      d.addEventListener("unload",
          function () {
            n && (n.onopen = null, n.onmessage = null, n.onclose = null);
            for (var a in v)v[a] && v[a].destroy();
            n = v = u = q = l = null;
            for (var b in h.events || {})h.events[b] && (h.events[b].length = 0), delete h.events[b];
            delete h.events
          });
      return h
    }(z, X, ha.identifier, Z || ua.test(da) && W(S) === V[0] && ga(S) === V[1], Y[0])
  }
})(window, location, document, ["widgets", "sdk"]);